<% cache [locale_and_user_status, investment, investment.budget, investment.projekt, investment.projekt.top_parent, investment.projekt.page, investment.image, investment.author, params[:tags], params[:projekts], params[:geozone_affiliation], params[:affiliated_geozones], params[:geozone_restriction], params[:restricted_geozones]] do %>
  <div id="<%= dom_id(investment) %>" class='row collapse resource-n budget-investment margin-bottom' data-equalizer='main' data-equalize-on="medium">

    <div class='columns'>
      <div class='show-for-small-only'>
        <%= render partial: 'shared/participation/projekt_bar', locals: { resource: investment } %>
      </div>
    </div>

    <div class='columns small-12 medium-3 large-2 show-for-small-only'>
      <% if show_image_thumbnail?(investment) %>
        <%= image_tag investment.image_url(:large), alt: investment.image.title.unicode_normalize %>
      <% end %>
    </div>

    <div class="columns small-12 medium-3 large-2 show-for-medium <%= "image-placeholder icon-#{ investment.projekt.icon || 'image' }" unless show_image_thumbnail?(investment) %>" data-equalizer-watch='main'>
      <% if show_image_thumbnail?(investment) %>
        <%= image_tag investment.image_url(:thumb_wider), alt: investment.image.title.unicode_normalize %>
      <% end %>
    </div>

    <div class='columns small-12 medium-9 large-10 details' data-equalizer-watch='main'>
      <div class='show-for-medium'>
        <%= render partial: 'shared/participation/projekt_bar', locals: { resource: investment } %>
      </div>

      <div class='resource-info' data-equalizer='details'>
        <div class='column small-12 medium-6 large-8 resource-details' data-equalizer-watch='details'>

          <h4 class='resource-name'><%= link_to investment.title, investment %></h4>
          <div class="resource-summary margin-bottom">
            <%= wysiwyg(investment.description) %>
            <div class="truncate"></div>
          </div>
          <% # render "shared/tags", taggable: investment, limit: 5 %>

        </div>
        <div class='column small-12 medium-6 large-4 resource-participate table' data-equalizer-watch='details'>
          <div class='table-cell align-middle'>

            <% unless investment.unfeasible? %>
              <% if investment.should_show_votes? %>
                <div id="<%= dom_id(investment) %>_votes" class="">
                     <%= render Budgets::Investments::VotesComponent.new(investment) %>
                </div>
              <% elsif investment.should_show_vote_count? %>
                <div id="<%= dom_id(investment) %>_votes" class="">
                  <div class="supports js-participation">
                    <span class="total-supports no-button">
                      <%= t("budgets.investments.investment.supports",
                          count: investment.total_votes) %>
                    </span>
                  </div>
                </div>
              <% elsif investment.should_show_ballots? && !management_controller? %>
                <div id="<%= dom_id(investment) %>_ballot" class="">
                      <%= render "/budgets/investments/ballot",
                        investment: investment,
                        investment_ids: investment_ids,
                        ballot: ballot %>
                </div>
              <% elsif investment.should_show_price? %>
                <div id="<%= dom_id(investment) %>_price" class="supports">
                  <div class="supports">
                    <span class="total-supports no-button">
                      <%= investment.formatted_price %>
                    </span>
                  </div>
                </div>
              <% end %>
            <% end %>

            <%= investment.budget.phase %>
            <br>

            <% if investment.budget.phase.in?(['reviewing', 'reviewing_ballots']) %>
              <div class="callout warning">
                <%= t("custom.budgets.investments.statuses.phases.#{investment.budget.phase}") %>
              </div>
            <% end %>

          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
